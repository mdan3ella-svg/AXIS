<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AXIS | Design Standards & Codes</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Inter & JetBrains Mono -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc; /* Cooler grey */
            --text-primary: #0f172a; /* Slate 900 */
            --text-secondary: #475569; /* Slate 600 */
            --accent: #0f766e; /* Teal 700 - Modern, Architectural */
            --accent-hover: #115e59; /* Teal 800 */
            --border: #e2e8f0;
            --font-main: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        /* Dark Mode */
        .dark-mode {
            --bg-primary: #0f172a; /* Slate 900 */
            --bg-secondary: #020617; /* Slate 950 */
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent: #2dd4bf; /* Teal 400 - Pop for dark mode */
            --accent-hover: #14b8a6;
            --border: #1e293b;
        }

        /* High Contrast Mode */
        .high-contrast {
            --bg-primary: #000000;
            --bg-secondary: #000000;
            --text-primary: #ffff00;
            --text-secondary: #00ff00;
            --accent: #00ffff;
            --accent-hover: #ffffff;
            --border: #ffff00;
        }

        /* Dyslexic Friendly Mode */
        .dyslexic-font {
            --font-main: 'Comic Sans MS', 'Chalkboard SE', sans-serif !important;
            letter-spacing: 0.05em;
            line-height: 1.8;
        }

        body {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            font-family: var(--font-main);
            transition: background-color 0.3s, color 0.3s;
        }

        .card {
            background-color: var(--bg-primary);
            border: 1px solid var(--border);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
            border-color: var(--accent);
        }

        .btn-primary {
            background-color: var(--accent);
            color: white;
        }
        
        .high-contrast .btn-primary {
            background-color: var(--bg-primary);
            color: var(--accent);
            border: 2px solid var(--accent);
        }

        /* Refined Grid Pattern for "Technical" look */
        .blueprint-grid {
            background-image: 
                linear-gradient(var(--border) 1px, transparent 1px),
                linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 40px 40px;
            mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 100%);
            -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 100%);
        }

        /* Badge Styling */
        .category-badge {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            letter-spacing: 0.05em;
        }

        #app {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
    </style>
</head>
<body>

<div id="app">
    <!-- Header -->
    <header class="sticky top-0 z-50 border-b border-[var(--border)] bg-[var(--bg-primary)] shadow-sm backdrop-blur-md bg-opacity-90">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center cursor-pointer group" onclick="router.navigate('home')">
                    <div class="bg-[var(--accent)] text-white p-1.5 rounded mr-2 group-hover:rotate-90 transition-transform duration-300">
                        <i data-lucide="axis-3d" class="h-6 w-6"></i>
                    </div>
                    <span class="font-bold text-xl tracking-tighter uppercase font-mono">AXIS</span>
                </div>

                <!-- Desktop Nav -->
                <nav class="hidden md:flex space-x-1">
                    <button onclick="router.navigate('home')" class="px-4 py-2 rounded-md text-[var(--text-secondary)] hover:text-[var(--accent)] hover:bg-[var(--bg-secondary)] font-medium transition-all">Library</button>
                    <button onclick="router.navigate('tools')" class="px-4 py-2 rounded-md text-[var(--text-secondary)] hover:text-[var(--accent)] hover:bg-[var(--bg-secondary)] font-medium transition-all">Tools</button>
                    <button onclick="router.navigate('bookmarks')" class="px-4 py-2 rounded-md text-[var(--text-secondary)] hover:text-[var(--accent)] hover:bg-[var(--bg-secondary)] font-medium transition-all">Bookmarks</button>
                </nav>

                <!-- Settings Toggle -->
                <div class="flex items-center space-x-2">
                    <button aria-label="Accessibility Settings" onclick="ui.toggleSettings()" class="p-2 rounded-full hover:bg-[var(--bg-secondary)] text-[var(--text-secondary)] transition-colors">
                        <i data-lucide="settings-2" class="w-5 h-5"></i>
                    </button>
                    <!-- Mobile Menu Button -->
                    <button class="md:hidden p-2 rounded-md hover:bg-[var(--bg-secondary)]" onclick="ui.toggleMobileMenu()">
                        <i data-lucide="menu"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Accessibility Panel (Hidden by default) -->
        <div id="accessibility-panel" class="hidden absolute top-16 right-0 w-full md:w-80 bg-[var(--bg-primary)] border-b border-l border-[var(--border)] shadow-xl p-6 z-50 rounded-bl-xl">
            <h3 class="font-bold text-sm uppercase tracking-wider mb-4 text-[var(--text-secondary)] flex items-center gap-2">
                <i data-lucide="eye" class="w-4 h-4"></i> View Settings
            </h3>
            
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <span class="font-medium">Dark Mode</span>
                    <button onclick="app.toggleTheme('dark')" class="w-12 h-6 bg-[var(--border)] rounded-full relative transition-colors duration-200 focus:outline-none">
                        <div id="toggle-dark" class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform duration-200 shadow-sm"></div>
                    </button>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-medium">High Contrast</span>
                    <button onclick="app.toggleTheme('contrast')" class="w-12 h-6 bg-[var(--border)] rounded-full relative transition-colors duration-200 focus:outline-none">
                        <div id="toggle-contrast" class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform duration-200 shadow-sm"></div>
                    </button>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-medium">Dyslexia Font</span>
                    <button onclick="app.toggleFont()" class="w-12 h-6 bg-[var(--border)] rounded-full relative transition-colors duration-200 focus:outline-none">
                        <div id="toggle-font" class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform duration-200 shadow-sm"></div>
                    </button>
                </div>
                <div class="pt-4 border-t border-[var(--border)]">
                    <span class="block mb-2 text-sm font-medium">Text Size</span>
                    <div class="flex space-x-2">
                        <button onclick="app.setFontSize('text-sm')" class="flex-1 p-2 text-xs border border-[var(--border)] rounded hover:bg-[var(--bg-secondary)] font-mono">Small</button>
                        <button onclick="app.setFontSize('text-base')" class="flex-1 p-2 text-sm border border-[var(--border)] rounded hover:bg-[var(--bg-secondary)] font-mono">Default</button>
                        <button onclick="app.setFontSize('text-lg')" class="flex-1 p-2 text-base border border-[var(--border)] rounded hover:bg-[var(--bg-secondary)] font-mono">Large</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="main-container" class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Dynamic Content Injected Here -->
    </main>

    <!-- Footer -->
    <footer class="bg-[var(--bg-primary)] border-t border-[var(--border)] py-10 mt-auto">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center text-[var(--text-secondary)] text-sm">
            <div class="mb-4 md:mb-0">
                <span class="font-bold text-[var(--text-primary)]">AXIS</span> &copy; 2024
            </div>
            <div class="flex space-x-6">
                <span>International Building Code (IBC) Compliant</span>
                <span>Design Matrix Integration</span>
            </div>
        </div>
    </footer>
</div>

<!-- DATA STORE -->
<script>
    const database = [
        // --- EXISTING CONTENT (Preserved) ---
        {
            id: 1,
            title: "ADA Ramp Standards",
            category: "Accessibility",
            tags: ["slope", "wheelchair", "handrail", "landing", "ADA"],
            content: "Max slope: 1:12 (8.33%). Max rise for any run: 30 inches. Min clear width: 36 inches. Landings: Min 60 inches length. Handrails required if rise > 6 inches.",
            diagram: `<svg viewBox="0 0 400 150" class="w-full h-auto border border-gray-300 bg-white"><path d="M50,100 L350,50" stroke="black" stroke-width="2"/><line x1="50" y1="100" x2="350" y2="100" stroke="black" stroke-dasharray="4"/><text x="200" y="120" text-anchor="middle" font-size="12">12 Units Run</text><line x1="350" y1="100" x2="350" y2="50" stroke="black"/><text x="360" y="75" font-size="12">1 Unit Rise</text></svg>`
        },
        {
            id: 2,
            title: "Standard Door Dimensions",
            category: "Dimensions",
            tags: ["residential", "commercial", "opening", "egress"],
            content: "Standard Height: 6'8\" (2032mm) or 7'0\" (2134mm). Widths: 30\", 32\", 36\". ADA Requirement: 32\" min clear width (approx 34\"-36\" door slab).",
            diagram: `<svg viewBox="0 0 200 200" class="w-full h-auto border border-gray-300 bg-white"><rect x="50" y="20" width="100" height="160" fill="none" stroke="black" stroke-width="2"/><path d="M50,20 L15,180" stroke="black" stroke-dasharray="4"/><path d="M50,180 A100,100 0 0,1 150,180" fill="none" stroke="blue" stroke-width="1"/><text x="100" y="195" text-anchor="middle" font-size="12">Door Swing</text></svg>`
        },
        
        // --- NEW IBC CODE GUIDE CONTENT ---
        {
            id: 13,
            title: "IBC Occupancy Groups",
            category: "Code",
            tags: ["IBC", "zoning", "classification", "safety"],
            content: "<strong>A (Assembly):</strong> Gathering (Theaters, Restaurants).<br><strong>B (Business):</strong> Office, Professional.<br><strong>E (Educational):</strong> Schools K-12.<br><strong>M (Mercantile):</strong> Retail.<br><strong>R (Residential):</strong> R-1 (Hotels), R-2 (Apartments), R-3 (Single Family).",
            diagram: null
        },
        {
            id: 14,
            title: "Egress Width Calculation (IBC)",
            category: "Code",
            tags: ["stairs", "exit", "safety", "occupancy"],
            content: "To calculate min width: Multiply Occupant Load by factor.<br><strong>Stairways:</strong> 0.3 inches per occupant.<br><strong>Other Components (Corridors/Doors):</strong> 0.2 inches per occupant.<br><em>Example:</em> 100 occupants x 0.3 = 30 inches (But min width codes often override to 44\").",
            diagram: null
        },
        {
            id: 15,
            title: "Fire Resistance Ratings",
            category: "Code",
            tags: ["fire", "wall", "UL", "safety"],
            content: "<strong>1-Hour Wall:</strong> Typically 5/8\" Type X Gypsum on both sides of studs.<br><strong>2-Hour Wall:</strong> Two layers of 5/8\" Type X Gypsum on both sides.<br>Required for separation between different Occupancy Groups (e.g., Garage vs Living).",
            diagram: `<svg viewBox="0 0 300 100" class="w-full h-auto border border-gray-300 bg-white"><rect x="140" y="10" width="20" height="80" fill="#ddd" stroke="black"/><rect x="130" y="10" width="10" height="80" fill="#fff" stroke="black"/><rect x="160" y="10" width="10" height="80" fill="#fff" stroke="black"/><text x="150" y="95" text-anchor="middle" font-size="10">1-Hour Assembly</text></svg>`
        },
        
        // --- NEW DESIGN MATRIX CONTENT ---
        {
            id: 16,
            title: "Adjacency Matrix",
            category: "Matrix",
            tags: ["planning", "programming", "schematic", "layout"],
            content: "A tool to define relationship strength between rooms before drawing plans.<br><strong>Primary (●):</strong> Must be adjacent (e.g., Kitchen & Dining).<br><strong>Secondary (○):</strong> Close proximity desirable.<br><strong>Undesirable (X):</strong> Must be separated (e.g., Quiet Reading & Noisy Gym).",
            diagram: `<svg viewBox="0 0 200 150" class="w-full h-auto border border-gray-300 bg-white"><rect x="20" y="20" width="40" height="40" fill="none" stroke="black"/><rect x="60" y="20" width="40" height="40" fill="none" stroke="black"/><rect x="20" y="60" width="40" height="40" fill="none" stroke="black"/><text x="40" y="45" text-anchor="middle">A</text><text x="80" y="45" text-anchor="middle">B</text><text x="40" y="85" text-anchor="middle">C</text><circle cx="80" cy="80" r="5" fill="black"/><text x="120" y="50" font-size="10">● Strong</text><text x="120" y="70" font-size="10">○ Weak</text></svg>`
        },
        {
            id: 17,
            title: "Programmatic Bubble Diagram",
            category: "Matrix",
            tags: ["concept", "flow", "circulation", "diagram"],
            content: "Visual translation of the Adjacency Matrix. Circles represent rooms (scaled to approx sq. ft.). Lines connect them to show circulation flow. Thick lines = Major flow. Dashed lines = Visual connection only.",
            diagram: null
        },
        {
            id: 18,
            title: "Space Standards Matrix",
            category: "Matrix",
            tags: ["planning", "occupancy", "area", "commercial"],
            content: "Rules of thumb for early planning:<br><strong>Office:</strong> 100-150 GSF/person.<br><strong>Restaurant Dining:</strong> 15-18 NSF/seat.<br><strong>Conference Room:</strong> 20-25 NSF/person.<br><strong>Residential Living:</strong> 200-400 sq. ft. typical for living rooms.",
            diagram: null
        },

        // --- PREVIOUS CONTENT ---
        {
            id: 3,
            title: "Line Weights & Types",
            category: "Drafting",
            tags: ["drawing", "conventions", "graphic", "standards"],
            content: "Line weights convey depth. <br><strong>Heavy:</strong> Section cuts, ground lines.<br><strong>Medium:</strong> Object outlines, furniture.<br><strong>Light:</strong> Dimension lines, hatch patterns.<br><strong>Dashed:</strong> Hidden lines, demolition, or overhead features.",
            diagram: `<svg viewBox="0 0 400 120" class="w-full h-auto border border-gray-300 bg-white"><line x1="20" y1="20" x2="380" y2="20" stroke="black" stroke-width="4"/><text x="200" y="35" text-anchor="middle" font-size="10">Cut Line (Heavy)</text><line x1="20" y1="60" x2="380" y2="60" stroke="black" stroke-width="2"/><text x="200" y="75" text-anchor="middle" font-size="10">Object Line (Medium)</text><line x1="20" y1="100" x2="380" y2="100" stroke="black" stroke-width="1" stroke-dasharray="5,5"/><text x="200" y="115" text-anchor="middle" font-size="10">Hidden Line (Dashed)</text></svg>`
        },
        {
            id: 5,
            title: "Kitchen Clearance Zones",
            category: "Dimensions",
            tags: ["residential", "ergonomics", "planning"],
            content: "Work Triangle: The sum of distances between sink, fridge, and stove should be < 26ft. <br>Minimum Aisle Width: 42\" for single cook, 48\" for multiple cooks. <br>Counter depth: Standard is 24\" (25\" with overhang).",
            diagram: null
        },
        {
            id: 6,
            title: "Concrete Material Properties",
            category: "Materials",
            tags: ["structure", "construction", "curing", "strength"],
            content: "Concrete is strong in compression but weak in tension (approx 10% of compressive strength). Steel reinforcement (rebar) is added to handle tensile forces. Typical cure time is 28 days to reach full design strength.",
            diagram: null
        },
        {
            id: 7,
            title: "Electrical Plan Symbols",
            category: "Drafting",
            tags: ["power", "lighting", "schematic"],
            content: "Standard symbols ensure readability across trades.<br><strong>$</strong>: Switch.<br><strong>$3</strong>: Three-way switch.<br><strong>Circle with two lines</strong>: Duplex Outlet.<br><strong>Circle with 'J'</strong>: Junction Box.",
            diagram: `<svg viewBox="0 0 300 100" class="w-full h-auto border border-gray-300 bg-white"><circle cx="40" cy="50" r="15" fill="none" stroke="black" stroke-width="2"/><line x1="30" y1="50" x2="50" y2="50" stroke="black"/><line x1="30" y1="45" x2="30" y2="55" stroke="black"/><line x1="50" y1="45" x2="50" y2="55" stroke="black"/><text x="40" y="85" text-anchor="middle" font-size="10">Duplex Outlet</text><text x="150" y="55" font-weight="bold" font-size="20">$</text><text x="150" y="85" text-anchor="middle" font-size="10">Switch</text></svg>`
        },
        {
            id: 8,
            title: "Stair Design Rules",
            category: "Code",
            tags: ["safety", "IBC", "rise", "run"],
            content: "IBC Standards for Commercial:<br>Max Rise: 7 inches.<br>Min Run: 11 inches.<br>Min Headroom: 80 inches.<br>Max vertical rise between landings: 12 feet.",
            diagram: null
        },
        {
            id: 10,
            title: "Window Types",
            category: "Materials",
            tags: ["fenestration", "ventilation", "opening"],
            content: "<strong>Double Hung:</strong> Two sashes slide vertically.<br><strong>Casement:</strong> Hinged on side, cranks out.<br><strong>Awning:</strong> Hinged at top, opens out.<br><strong>Fixed:</strong> Does not open (Picture window).",
            diagram: null
        },
        {
            id: 11,
            title: "Toilet Clearances (ADA)",
            category: "Accessibility",
            tags: ["bathroom", "restroom", "plumbing", "ADA"],
            content: "Centerline of toilet must be 16\"-18\" from side wall. Clearance around toilet: Min 60\" width. Grab bars required: Side wall (42\" min), Rear wall (36\" min). Toilet seat height: 17\"-19\".",
            diagram: null
        },
    ];

    const categories = [
        { id: 'all', name: 'All', icon: 'grid' },
        { id: 'Code', name: 'IBC & Code', icon: 'shield-alert' },
        { id: 'Matrix', name: 'Design Matrix', icon: 'layout-grid' },
        { id: 'Dimensions', name: 'Dimensions', icon: 'ruler' },
        { id: 'Drafting', name: 'Drafting', icon: 'pencil-ruler' },
        { id: 'Accessibility', name: 'Accessibility', icon: 'armchair' },
        { id: 'Materials', name: 'Materials', icon: 'brick-wall' },
    ];
</script>

<!-- APPLICATION LOGIC -->
<script>
    // --- State Management ---
    const app = {
        theme: 'light', // light, dark, contrast
        fontSize: 'text-base',
        fontType: 'standard', // standard, dyslexic
        bookmarks: JSON.parse(localStorage.getItem('axisBookmarks')) || [], // Updated Storage Key
        
        init() {
            this.loadPreferences();
            router.navigate('home');
            lucide.createIcons();
        },

        loadPreferences() {
            const savedTheme = localStorage.getItem('axisTheme') || 'light';
            const savedFont = localStorage.getItem('axisFont') || 'standard';
            this.setTheme(savedTheme);
            if(savedFont === 'dyslexic') this.toggleFont(true);
        },

        setTheme(mode) {
            this.theme = mode;
            document.body.classList.remove('dark-mode', 'high-contrast');
            if (mode === 'dark') document.body.classList.add('dark-mode');
            if (mode === 'contrast') document.body.classList.add('high-contrast');
            
            // UI Toggles State
            document.getElementById('toggle-dark').style.transform = mode === 'dark' ? 'translateX(1.5rem)' : 'translateX(0)';
            document.getElementById('toggle-contrast').style.transform = mode === 'contrast' ? 'translateX(1.5rem)' : 'translateX(0)';
            
            localStorage.setItem('axisTheme', mode);
        },

        toggleTheme(target) {
            if (this.theme === target) this.setTheme('light');
            else this.setTheme(target);
        },

        toggleFont(force = false) {
            const body = document.body;
            if (force || !body.classList.contains('dyslexic-font')) {
                body.classList.add('dyslexic-font');
                this.fontType = 'dyslexic';
                document.getElementById('toggle-font').style.transform = 'translateX(1.5rem)';
            } else {
                body.classList.remove('dyslexic-font');
                this.fontType = 'standard';
                document.getElementById('toggle-font').style.transform = 'translateX(0)';
            }
            localStorage.setItem('axisFont', this.fontType);
        },

        setFontSize(size) {
            this.fontSize = size;
            const content = document.getElementById('main-container');
            content.classList.remove('text-sm', 'text-base', 'text-lg');
            content.classList.add(size);
        },

        toggleBookmark(id) {
            if (this.bookmarks.includes(id)) {
                this.bookmarks = this.bookmarks.filter(b => b !== id);
            } else {
                this.bookmarks.push(id);
            }
            localStorage.setItem('axisBookmarks', JSON.stringify(this.bookmarks));
            
            // Re-render based on current view
            const current = router.currentPage;
            if (current === 'bookmarks') views.bookmarks();
            else if (current === 'article') views.article(id);
            else views.renderCardButton(id);
        }
    };

    // --- Routing & Navigation ---
    const router = {
        currentPage: 'home',

        navigate(page, param = null) {
            this.currentPage = page;
            const container = document.getElementById('main-container');
            container.innerHTML = ''; // Clear content
            window.scrollTo(0,0);

            switch(page) {
                case 'home':
                    views.home();
                    break;
                case 'article':
                    views.article(param);
                    break;
                case 'bookmarks':
                    views.bookmarks();
                    break;
                case 'tools':
                    views.tools();
                    break;
            }
            lucide.createIcons();
            
            const menu = document.getElementById('accessibility-panel');
            if(!menu.classList.contains('hidden')) ui.toggleSettings();
        }
    };

    // --- UI Views ---
    const views = {
        home() {
            const container = document.getElementById('main-container');
            
            // Search Hero
            const hero = document.createElement('div');
            hero.className = "mb-10 py-16 px-6 rounded-2xl bg-[var(--bg-primary)] border border-[var(--border)] blueprint-grid shadow-sm relative overflow-hidden";
            hero.innerHTML = `
                <div class="relative z-10 max-w-2xl">
                    <span class="text-[var(--accent)] font-mono text-sm tracking-widest uppercase font-bold mb-2 block">The Modern Design Standard</span>
                    <h1 class="text-4xl md:text-6xl font-bold mb-6 text-[var(--text-primary)] tracking-tight">Design with <br>Confidence.</h1>
                    <p class="mb-8 text-[var(--text-secondary)] text-lg max-w-lg">Instant access to IBC Codes, Design Matrices, and Drafting Standards.</p>
                    <div class="relative">
                        <input type="text" 
                            oninput="views.handleSearch(this.value)" 
                            placeholder="Try 'Egress', 'Adjacency', 'Fire Rating'..." 
                            class="w-full p-4 pl-12 rounded-lg border-2 border-[var(--border)] bg-[var(--bg-secondary)] focus:border-[var(--accent)] focus:outline-none text-lg transition-colors font-mono shadow-sm">
                        <i data-lucide="search" class="absolute left-4 top-5 text-[var(--text-secondary)]"></i>
                    </div>
                </div>
            `;
            container.appendChild(hero);

            // Category filters
            const catContainer = document.createElement('div');
            catContainer.className = "mb-8 overflow-x-auto pb-2 no-scrollbar";
            catContainer.innerHTML = `
                <div class="flex space-x-2 min-w-max">
                    ${categories.map(cat => `
                        <button onclick="views.filterByCategory('${cat.id}')" 
                        class="px-5 py-2.5 rounded-lg border border-[var(--border)] bg-[var(--bg-primary)] hover:border-[var(--accent)] hover:text-[var(--accent)] transition-all flex items-center gap-2 font-medium text-sm group">
                        <i data-lucide="${cat.icon}" class="w-4 h-4 text-[var(--text-secondary)] group-hover:text-[var(--accent)]"></i> ${cat.name}</button>
                    `).join('')}
                </div>`;
            container.appendChild(catContainer);

            // Results Container
            const results = document.createElement('div');
            results.id = "feed-results";
            results.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6";
            container.appendChild(results);

            this.renderCards(database, results);
        },

        tools() {
            const container = document.getElementById('main-container');
            container.innerHTML = `
                <h2 class="text-3xl font-bold mb-8 tracking-tight">Utility Tools</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- Unit Converter -->
                    <div class="card p-8 rounded-2xl shadow-sm">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="p-2 bg-[var(--bg-secondary)] rounded-lg"><i data-lucide="arrow-right-left" class="text-[var(--accent)]"></i></div>
                            <h3 class="text-xl font-bold">Unit Converter</h3>
                        </div>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-mono font-bold text-[var(--text-secondary)] uppercase mb-1">Feet</label>
                                    <input type="number" id="conv-feet" class="w-full p-3 border border-[var(--border)] rounded bg-[var(--bg-secondary)] focus:border-[var(--accent)] focus:outline-none font-mono" oninput="tools.convert('ft', this.value)">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono font-bold text-[var(--text-secondary)] uppercase mb-1">Inches</label>
                                    <input type="number" id="conv-inch" class="w-full p-3 border border-[var(--border)] rounded bg-[var(--bg-secondary)] focus:border-[var(--accent)] focus:outline-none font-mono" oninput="tools.convert('in', this.value)">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-mono font-bold text-[var(--text-secondary)] uppercase mb-1">Millimeters</label>
                                    <input type="number" id="conv-mm" class="w-full p-3 border border-[var(--border)] rounded bg-[var(--bg-secondary)] focus:border-[var(--accent)] focus:outline-none font-mono" oninput="tools.convert('mm', this.value)">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono font-bold text-[var(--text-secondary)] uppercase mb-1">Meters</label>
                                    <input type="number" id="conv-m" class="w-full p-3 border border-[var(--border)] rounded bg-[var(--bg-secondary)] focus:border-[var(--accent)] focus:outline-none font-mono" oninput="tools.convert('m', this.value)">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Scale Calculator -->
                    <div class="card p-8 rounded-2xl shadow-sm">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="p-2 bg-[var(--bg-secondary)] rounded-lg"><i data-lucide="maximize" class="text-[var(--accent)]"></i></div>
                            <h3 class="text-xl font-bold">Scale Calculator</h3>
                        </div>
                        
                        <div class="space-y-5">
                            <div class="flex gap-4">
                                <div class="flex-1">
                                    <label class="block text-xs font-mono font-bold text-[var(--text-secondary)] uppercase mb-1">Paper Dim (in)</label>
                                    <input type="number" id="scale-input" class="w-full p-3 border border-[var(--border)] rounded bg-[var(--bg-secondary)] focus:border-[var(--accent)] focus:outline-none font-mono">
                                </div>
                                <div class="flex-1">
                                    <label class="block text-xs font-mono font-bold text-[var(--text-secondary)] uppercase mb-1">Scale</label>
                                    <select id="scale-select" class="w-full p-3 border border-[var(--border)] rounded bg-[var(--bg-secondary)] focus:outline-none font-mono text-sm">
                                        <option value="48">1/4" = 1'-0"</option>
                                        <option value="96">1/8" = 1'-0"</option>
                                        <option value="24">1/2" = 1'-0"</option>
                                        <option value="12">1" = 1'-0"</option>
                                    </select>
                                </div>
                            </div>
                            <button onclick="tools.calcScale()" class="btn-primary w-full py-3 rounded-lg font-bold shadow-md hover:opacity-90 transition-opacity">Calculate</button>
                            <div id="scale-result" class="p-4 bg-[var(--bg-secondary)] border border-[var(--border)] rounded-lg text-center font-mono text-lg hidden"></div>
                        </div>
                    </div>
                </div>
            `;
        },

        bookmarks() {
            const container = document.getElementById('main-container');
            container.innerHTML = `<h2 class="text-3xl font-bold mb-8 flex items-center gap-2"><i data-lucide="bookmark" class="text-[var(--accent)]"></i> Saved References</h2>`;
            
            const results = document.createElement('div');
            results.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6";
            
            if (app.bookmarks.length === 0) {
                results.innerHTML = `
                    <div class="col-span-3 text-center py-20 bg-[var(--bg-primary)] rounded-2xl border border-[var(--border)] border-dashed">
                        <i data-lucide="bookmark-minus" class="mx-auto w-12 h-12 text-[var(--text-secondary)] opacity-50 mb-4"></i>
                        <p class="text-[var(--text-secondary)]">Your collection is empty.<br>Save articles to access them quickly.</p>
                    </div>`;
            } else {
                const bookmarkedData = database.filter(item => app.bookmarks.includes(item.id));
                this.renderCards(bookmarkedData, results);
            }
            container.appendChild(results);
        },

        article(id) {
            const data = database.find(i => i.id == id);
            const container = document.getElementById('main-container');
            const isBookmarked = app.bookmarks.includes(data.id);
            
            container.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <button onclick="window.history.back()" class="mb-6 text-[var(--text-secondary)] hover:text-[var(--accent)] flex items-center gap-2 text-sm font-medium transition-colors">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i> Return to Library
                    </button>
                    <article class="card rounded-2xl overflow-hidden shadow-xl border-0">
                        <div class="bg-[var(--bg-primary)] p-8 md:p-10 border-b border-[var(--border)]">
                            <div class="flex justify-between items-start mb-4">
                                <span class="category-badge text-[var(--accent)] bg-[var(--bg-secondary)] px-3 py-1 rounded-full uppercase">${data.category}</span>
                                <button onclick="app.toggleBookmark(${data.id})" class="p-2 rounded-full hover:bg-[var(--bg-secondary)] ${isBookmarked ? 'text-[var(--accent)] fill-current' : 'text-[var(--text-secondary)]'} transition-colors">
                                    <i data-lucide="bookmark" class="${isBookmarked ? 'fill-current' : ''}"></i>
                                </button>
                            </div>
                            <h1 class="text-3xl md:text-4xl font-bold mb-4 tracking-tight">${data.title}</h1>
                            <div class="flex gap-2 flex-wrap">
                                ${data.tags.map(t => `<span class="text-[var(--text-secondary)] text-sm font-mono opacity-75">#${t}</span>`).join('')}
                            </div>
                        </div>
                        
                        <div class="p-8 md:p-10 grid grid-cols-1 lg:grid-cols-3 gap-10">
                            <div class="lg:col-span-2 space-y-6">
                                <div class="text-lg leading-relaxed font-light">${data.content}</div>
                                
                                <div class="mt-8 p-5 bg-[var(--bg-secondary)] border-l-4 border-[var(--accent)] rounded-r-lg">
                                    <h3 class="font-bold text-sm uppercase tracking-wider mb-2 flex items-center gap-2">
                                        <i data-lucide="shield-check" class="w-4 h-4 text-[var(--accent)]"></i> Compliance Note
                                    </h3>
                                    <p class="text-sm text-[var(--text-secondary)]">
                                        Standards referenced align with general IBC/ADA guidelines. Always verify with local AHJ (Authority Having Jurisdiction) amendments.
                                    </p>
                                </div>
                            </div>

                            <div class="bg-[var(--bg-secondary)] p-6 rounded-xl border border-[var(--border)] flex items-center justify-center min-h-[240px]">
                                ${data.diagram ? data.diagram : '<div class="text-center text-[var(--text-secondary)]"><i data-lucide="image-off" class="mx-auto mb-3 opacity-30 w-10 h-10"></i><br><span class="text-sm">No Diagram Available</span></div>'}
                            </div>
                        </div>
                    </article>
                </div>
            `;
        },

        handleSearch(query) {
            const term = query.toLowerCase();
            const resultsDiv = document.getElementById('feed-results');
            
            if (term.length < 1) {
                this.renderCards(database, resultsDiv);
                return;
            }

            const filtered = database.filter(item => 
                item.title.toLowerCase().includes(term) || 
                item.tags.some(tag => tag.toLowerCase().includes(term)) ||
                item.content.toLowerCase().includes(term)
            );
            
            this.renderCards(filtered, resultsDiv);
            lucide.createIcons();
        },

        filterByCategory(catId) {
            const resultsDiv = document.getElementById('feed-results');
            if (catId === 'all') {
                this.renderCards(database, resultsDiv);
            } else {
                const filtered = database.filter(item => item.category === catId);
                this.renderCards(filtered, resultsDiv);
            }
            lucide.createIcons();
        },

        renderCards(data, container) {
            container.innerHTML = '';
            
            if(data.length === 0) {
                container.innerHTML = `<div class="col-span-3 text-center py-12 text-[var(--text-secondary)] opacity-75">No results found matching criteria.</div>`;
                return;
            }

            data.forEach(item => {
                const card = document.createElement('div');
                card.className = "card rounded-xl p-6 flex flex-col h-full cursor-pointer group hover:border-[var(--accent)]";
                card.onclick = (e) => {
                    if(!e.target.closest('button')) router.navigate('article', item.id);
                };
                
                const isBookmarked = app.bookmarks.includes(item.id);
                // Clean HTML tags for snippet view
                const cleanContent = item.content.replace(/<[^>]*>?/gm, '');
                const snippet = cleanContent.length > 90 ? cleanContent.substring(0, 90) + "..." : cleanContent;

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <span class="category-badge text-[var(--accent)] bg-[var(--bg-secondary)] px-2 py-1 rounded">${item.category}</span>
                        <button onclick="event.stopPropagation(); app.toggleBookmark(${item.id})" id="btn-bm-${item.id}" class="text-[var(--text-secondary)] hover:text-[var(--accent)] transition-colors">
                            <i data-lucide="bookmark" class="w-5 h-5 ${isBookmarked ? 'fill-current text-[var(--accent)]' : ''}"></i>
                        </button>
                    </div>
                    <h3 class="font-bold text-xl mb-3 group-hover:text-[var(--accent)] transition-colors tracking-tight">${item.title}</h3>
                    <p class="text-[var(--text-secondary)] mb-6 flex-grow text-sm leading-relaxed">${snippet}</p>
                    <div class="flex items-center text-xs text-[var(--text-secondary)] gap-2 mt-auto pt-4 border-t border-[var(--border)] font-mono opacity-80">
                        <i data-lucide="hash" class="w-3 h-3"></i>
                        <span>${item.tags[0]}</span>
                    </div>
                `;
                container.appendChild(card);
            });
            lucide.createIcons();
        },
        
        renderCardButton(id) {
            const btn = document.getElementById(`btn-bm-${id}`);
            if(btn) {
                const isBookmarked = app.bookmarks.includes(id);
                btn.innerHTML = `<i data-lucide="bookmark" class="w-5 h-5 ${isBookmarked ? 'fill-current text-[var(--accent)]' : ''}"></i>`;
                lucide.createIcons();
            }
        }
    };

    // --- Tools Logic ---
    const tools = {
        convert(unit, val) {
            if(!val) return;
            val = parseFloat(val);
            const els = {
                ft: document.getElementById('conv-feet'),
                in: document.getElementById('conv-inch'),
                mm: document.getElementById('conv-mm'),
                m: document.getElementById('conv-m')
            };

            if (unit === 'ft') {
                els.in.value = (val * 12).toFixed(2);
                els.mm.value = (val * 304.8).toFixed(2);
                els.m.value = (val * 0.3048).toFixed(3);
            } else if (unit === 'in') {
                els.ft.value = (val / 12).toFixed(3);
                els.mm.value = (val * 25.4).toFixed(2);
                els.m.value = (val * 0.0254).toFixed(3);
            } else if (unit === 'mm') {
                els.ft.value = (val / 304.8).toFixed(3);
                els.in.value = (val / 25.4).toFixed(2);
                els.m.value = (val / 1000).toFixed(3);
            } else if (unit === 'm') {
                els.ft.value = (val / 0.3048).toFixed(3);
                els.in.value = (val / 0.0254).toFixed(2);
                els.mm.value = (val * 1000).toFixed(0);
            }
        },

        calcScale() {
            const input = parseFloat(document.getElementById('scale-input').value);
            const scale = parseInt(document.getElementById('scale-select').value);
            const output = document.getElementById('scale-result');
            
            if(isNaN(input)) return;

            const realInches = input * scale;
            const feet = Math.floor(realInches / 12);
            const inches = realInches % 12;

            output.classList.remove('hidden');
            output.innerHTML = `Real World Size: <strong>${feet}'-${inches}"</strong>`;
        }
    };

    // --- UI Helper ---
    const ui = {
        toggleSettings() {
            const panel = document.getElementById('accessibility-panel');
            panel.classList.toggle('hidden');
        },
        toggleMobileMenu() {
            this.toggleSettings();
        }
    };

    window.addEventListener('DOMContentLoaded', () => {
        app.init();
    });

</script>
</body>

</html>
